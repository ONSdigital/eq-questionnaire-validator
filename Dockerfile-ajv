FROM node:24
# Create app directory
WORKDIR /usr/src/app

# Install app dependencies
COPY package.json ./
COPY package-lock.json ./

COPY ajv/app.js .
COPY schemas ../schemas

RUN npm install --production=true

ENV AJV_VALIDATOR_PORT=5002
ENV DEBUG=ajv-schema-validator

WORKDIR /usr/src

# Set the user running the application to the non-root user
USER appuser

HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:5002/docs || exit 1

CMD [ "node", "app/app.js" ]
